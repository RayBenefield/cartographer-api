package com.cartographerapi.domain;

import java.util.List;
import java.util.ArrayList;
import com.fasterxml.jackson.databind.ObjectMapper;
import java.io.IOException;
import com.fasterxml.jackson.databind.JsonNode;

public class PlayerGamesHaloApiReader implements PlayerGamesReader {

	private Halo5ApiWrapper api;
	private ObjectMapper mapper;
	private Integer total;
	
	public PlayerGamesHaloApiReader() {
		this.api = new Halo5ApiWrapper("ae4df7c91357455ea30be2d7bdf15522");
		this.mapper = new ObjectMapper();
	}

	@Override
	public List<PlayerGame> getPlayerGamesByGamertag(String gamertag) {
		return getPlayerGamesByGamertag(gamertag, 0, 25);
	}

	@Override
	public List<PlayerGame> getPlayerGamesByGamertag(String gamertag, Integer start, Integer count) {
		List<PlayerGame> results = new ArrayList<PlayerGame>();
		try {
			String gamesResult = api.customGames(gamertag, total - start - 24, count);
			JsonNode root = mapper.readTree(gamesResult);
			if (root.path("Results").path(24).path("Id").path("MatchId").asText().equals(lastMatchId);
			Integer numberOfGame = start;
			for (JsonNode game : root.path("Results")) {
				PlayerGame newGame = new PlayerGame(gamertag, numberOfGame, game);
				results.add(newGame);
				numberOfGame++;
			}
		} catch (IOException exception) {
			return null;
		}
		return results;
	}

	public void setTotal(Integer total) {
		this.total = total;
	}

}
