package com.cartographerapi.domain;

import java.util.List;
import com.amazonaws.services.sqs.model.ReceiveMessageRequest;
import com.amazonaws.services.sqs.model.DeleteMessageRequest;
import com.amazonaws.services.sqs.model.Message;
import com.amazonaws.services.sqs.AmazonSQSClient;

public class PlayerGamesSqsReader implements PlayerGamesQueueReader {

	private AmazonSQSClient client;
	private String queueUrl;

	public PlayerGamesSqsReader(String queueUrl) {
		client = new AmazonSQSClient();
		this.queueUrl = queueUrl;
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public List<PlayerGame> getNumberOfPlayerGames(Integer count) {
        ReceiveMessageRequest receiveMessageRequest = new ReceiveMessageRequest(myQueueUrl);
        receiveMessageRequest.setMaxNumberOfMessages(10);
        List<Message> messages = sqs.receiveMessage(receiveMessageRequest).getMessages();
		String matchId = "";
        for (Message message : messages) {
			context.getLogger().log(message.getBody());
			try {
				JsonNode msgNode = mapper.readTree(mapper.readTree(message.getBody()).path("Message").textValue());
				matchId = msgNode.path("matchId").asText();
				context.getLogger().log(matchId);
			} catch (IOException exception) {
			}
		return null;
	}

}
