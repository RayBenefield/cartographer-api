package com.cartographerapi.customgames;

import com.amazonaws.services.lambda.runtime.Context;
import com.amazonaws.services.lambda.runtime.RequestHandler;

public class CustomGameCountHandler implements RequestHandler<Gamertag, PlayerGameCounts> {

	PlayerGameCountsReader cacheReader = new PlayerGameCountsDynamoReader();
	PlayerGameCountsWriter cacheWriter = new PlayerGameCountsDynamoWriter();
	PlayerGameCountsReader sourceReader = new PlayerGameCountsHaloApiReader();
	
    @Override
    public PlayerGameCounts handleRequest(Gamertag input, Context context) {
        context.getLogger().log("Input: " + input.getGamertag());

		PlayerGameCounts counts = cacheReader.getPlayerGameCountsByGamertag(input.getGamertag());
		
		if (counts == null) {
			counts = sourceReader.getPlayerGameCountsByGamertag(input.getGamertag());
		} else {
			counts = sourceReader.getPlayerGameCountsByPlayerGameCounts(counts);
		}

		cacheWriter.savePlayerGameCounts(counts);
		return counts;
    }
}