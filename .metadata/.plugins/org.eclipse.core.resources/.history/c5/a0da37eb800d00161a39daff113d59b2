package com.cartographerapi.functions;

import com.amazonaws.services.lambda.runtime.Context;
import com.amazonaws.services.lambda.runtime.RequestHandler;

import java.util.List;

import com.cartographerapi.domain.DomainQueueFillRequest;

import com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBMapper;
import com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBScanExpression;
import com.amazonaws.services.dynamodbv2.AmazonDynamoDBClient; 

import com.amazonaws.regions.Region;
import com.amazonaws.regions.Regions;

public class DomainQueueFiller implements RequestHandler<DomainQueueFillRequest, List<Object>> {

    @Override
    public List<Object> handleRequest(DomainQueueFillRequest input, Context context) {
        context.getLogger().log("Input: " + input);

		try {
			AmazonDynamoDBClient client = new AmazonDynamoDBClient();
			client.setRegion(Region.getRegion(Regions.US_WEST_2));
			DynamoDBMapper dbMapper = new DynamoDBMapper(client);
			
			DynamoDBScanExpression scanExpression = new DynamoDBScanExpression();
			List<Object> games = new ArrayList<Object>(dbMapper.parallelScan(Class.forName("com.cartographerapi.domain.game.Game"), scanExpression, 3));
			
			ObjectSqsWriter writer = new ObjectSqsWriter("sqsTestScan");
			writer.saveObjects(games);
		} catch (IOException exception) {
			System.out.println("oops");
		} catch (ClassNotFoundException exception) {
			System.out.println("oops");
		}

        return null;
    }

}
